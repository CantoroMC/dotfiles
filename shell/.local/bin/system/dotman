#!/bin/zsh

AUR_HELPER=${AUR_HELPER:-'auracle-git'}
DOTFILES=${DOTFILES:-$HOME'/dotfiles'}
PKG_LISTS_DIR=$DOTFILES/deploy/arch-repo/pacman-pkgs
PKGS=(bull-pkgs gtk-pkgs xmonad-extra-pkgs programming-pkgs)
BOXES=(git emacs neovim texlive music mail shell haskell x-window)
XDG_CONFIG_HOME=${XDG_CONFIG_HOME:-$HOME'/.config'}
XDG_DATA_HOME=${XDG_DATA_HOME:-$HOME'/.local/share'}
HOMIES=(
  .cabal
  .ghc
  .local/bin
  )
CONFIGS=(
  emacs
  git
  gtk-2.0
  gtk-3.0
  mpd/playlists
  nautilus
  neomutt
  nnn
  nvim
  radiotray-ng
  surf
  zsh/plugins
)
DATAS=(
  nvim/site/pack
  xorg
  fonts
  nautilus/scripts
  surf
  stack
)


wrap_pacman() {
  sudo pacman -S --needed - < ${1}
}

packages_pacman() {
  sudo pacman -Syu
  for pkg ($PKGS); do
    wrap_pacman "$PKG_LISTS_DIR"/"$pkg".txt
  done
  sudo pacman -S --needed --asdeps - < "$PKG_LISTS_DIR"/dependent-pkgs.txt
}

aur_helper(){
  cd ~/Downloads
  git clone https://aur.archlinux.org/$AUR_HELPER
  cd $AUR_HELPER
  makepkg -sri
  cd ..
  rm -rf $AUR_HELPER
}


check_mkdir() {
  [ ! -d "${1}" ] && mkdir -p "${1}" || echo -e "\e[1;97m${1} already exists.\e[0m"
}

prepare_ft(){
  for dir ($HOMIES); do
    check_mkdir "$HOME"/"$dir"
  done
  for dir ($CONFIGS); do
    check_mkdir "$XDG_CONFIG_HOME"/"$dir"
  done
  for dir ($DATAS); do
    check_mkdir "$XDG_DATA_HOME"/"$dir"
  done
}

use_stow() {
  cd $DOTFILES
  stow -R ${BOXES[@]}
}

helper(){
  cat << _EOF_
  This is the help function but it still TODO
_EOF_
}

main() {
  case ${1} in
    "pkg")
      packages_pacman
      ;;
    "aur_helper")
      aur_helper
      ;;
    "prepare")
      prepare_ft
      ;;
    "stow")
      use_stow
      ;;
    "help")
      helper
      ;;
    *)
      helper
      ;;
  esac
}

main "$@"
